---
title: "ãƒ¬ã‚¤ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°(13): Progressive Photon Mapping (ãŸã ã—æœ¬å®¶ã§ã¯ãªã„)"
emoji: "ðŸ’¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Haskell", "RayTracing", "PhotonMapping"]
published: true
---

[ä»Šå›žã®ã‚½ãƒ¼ã‚¹](https://github.com/eijian/raytracer/tree/version-2.6.2.1)ã¯ã“ã¡ã‚‰ã€‚

## 1. ç´ ã®ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°ã®èª²é¡Œ

ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ã«ã‚ˆã‚‹ç”»åƒç”Ÿæˆã¯å¾“æ¥ã®æ‰‹æ³•ï¼ˆãƒ‘ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãªã©ï¼‰ã«æ¯”ã¹ã‹ãªã‚Šå°‘ãªã„ãƒ¬ã‚¤æ•°ã§ã‚‚é–“æŽ¥å…‰ã‚„é›†å…‰æ¨¡æ§˜ã‚’ç¶ºéº—ã«è¡¨ç¾ã§ãã‚‹ã¨ã¦ã‚‚ç´ æ™´ã‚‰ã—ã„æ‰‹æ³•ã ã¨æ€ã†ã€‚ã¨ã¯ã„ãˆãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ã‚‚å®Œç’§ã§ã¯ãªã„ã€‚ã‚ã‚‹ç‚¹ã®è‰²ï¼ˆè¼åº¦ï¼‰ã‚’æ±‚ã‚ã‚‹ãŸã‚ã€æœ‰é™ã®ãƒ•ã‚©ãƒˆãƒ³ã¨æœ‰é™ã®é ˜åŸŸï¼ˆé¢ç©ï¼‰ã‹ã‚‰æ”¾å°„è¼åº¦æŽ¨å®šã‚’è¡Œã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã‚ã‚‹ã€‚å®Œç’§ãªç”»åƒã‚’å¾—ã‚‹ãŸã‚ã«ã¯ã€ç„¡é™å€‹ã®ãƒ•ã‚©ãƒˆãƒ³ã€ç„¡é™å°ã®é ˜åŸŸã§æŽ¨å®šã™ã‚Œã°ã„ã„ã®ã ãŒã€ç¾å®Ÿçš„ã«ã¯ä¸å¯èƒ½ã§ã‚ã‚‹ã€‚ãã®ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚‹ï¼ˆã¨æ€ã†ï¼‰ã€‚

* ãƒ•ã‚©ãƒˆãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šå¤§é‡ã®ãƒ•ã‚©ãƒˆãƒ³ã‚’ä½¿ã£ãŸè¨ˆç®—ã‚’ã™ã‚‹ã«ã¯å¤§é‡ã®ãƒ¡ãƒ¢ãƒªã‚’æŒã¤ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒå¿…è¦ã€‚
* æ”¾å°„è¼åº¦æŽ¨å®šã«å¿…è¦ãªãƒ•ã‚©ãƒˆãƒ³ã‚’æŠ½å‡ºã™ã‚‹ãŸã‚kdæœ¨ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä½¿ã£ã¦ã„ã¦æ¯”è¼ƒçš„åŠ¹çŽ‡ã¯è‰¯ã„ã‚ˆã†ã ãŒã€ãƒ•ã‚©ãƒˆãƒ³æ•°ãŒå¢—ãˆã‚‹ã¨æŠ½å‡ºã«ã¨ã¦ã‚‚æ™‚é–“ãŒæŽ›ã‹ã‚‹ã€‚
* ãƒ•ã‚©ãƒˆãƒ³æ•°ã‚’å°‘ãªãã™ã‚Œã°ãƒŽã‚¤ã‚ºï¼ˆè‰²ã®æ»²ã¿ï¼‰ãŒå¤šããªã‚‹ã€‚ã“ã‚Œã¯æŽ¨å®šã«ä½¿ã†ãƒ•ã‚©ãƒˆãƒ³ãŒå°‘ãªã„ã®ã§æŽ¨å®šå€¤ã¨çœŸã®è¼åº¦ã¨ã®å·®ãŒå¤§ãããªã‚‹ãŸã‚ã€‚
* ãƒŽã‚¤ã‚ºã‚’æ¸›ã‚‰ãã†ã¨æ€ã†ã¨ã€ã‚ˆã‚Šåºƒã„é ˜åŸŸã‹ã‚‰å¤šæ•°ã®ãƒ•ã‚©ãƒˆãƒ³ã‚’é›†ã‚ã‚Œã°è‰¯ã„ãŒã€ä½™è¨ˆãªãƒ•ã‚©ãƒˆãƒ³ã‚‚æŽ¨å®šã«ä½¿ã‚ã‚Œã€ã¾ãŸè¼åº¦å€¤ãŒå‘¨ã‚Šã¨å¹³å‡åŒ–ã•ã‚Œå…¨ä½“çš„ã«ã¼ã‚„ã‘ãŸç”»åƒã«ãªã‚‹ï¼ˆå½±ã®ç¸ãŒé‹­ããªã‚‰ãªã„ï¼‰ã€‚

ã“ã®ã‚ˆã†ãªèª²é¡Œã«å¯¾å¿œã™ã‚‹æ‰‹æ³•ã¯ã„ã‚ã„ã‚ææ¡ˆã•ã‚Œã¦ãŠã‚Šã€ç›´ç³»ï¼ˆï¼Ÿï¼‰ã®ç ”ç©¶ã§ã¯ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ãŒã‚ã‚‹ã€‚ã“ã‚Œã¯ã•ã‚‰ã«æ”¹è‰¯ã•ã‚Œã¦Stocastic Progressive Photon Maapingã¨ãªã£ã¦ã„ã‚‹ãã†ã ã€‚ä»¥ä¸‹ã¯å‚è€ƒURLã€‚

* [ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°1](https://www.cgarts.or.jp/report/rep_kr/rep1102-2.html)
* [ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°2](http://project-asura.com/blog/archives/75)
* [Adaptive Photon Mapping](https://cg.ivd.kit.edu/publications/p2012/APPM_Kaplanyan_2012/APPM_Kaplanyan_2012.pdf)
* [Probabilistic Approach](https://www.cs.umd.edu/~zwicker/publications/PPMProbabilistic-TOG11.pdf)
* [Probabilistic Approach(æ—¥æœ¬èªžè¨³)](http://project-asura.com/blog/archives/146)

ã»ã‹ã«ã‚‚ã€ã„ã‚ã„ã‚ç ”ç©¶ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚ä»Šå›žã¯ã“ã®ä¸­ã‹ã‚‰ Probabilistic Approach ã¨ã„ã†æ‰‹æ³•ã‚’é¸æŠžã—ãŸã€‚ç†ç”±ã¯æ¬¡ã®é€šã‚Šã€‚

* æ”¾å°„è¼åº¦æŽ¨å®šã«ä½¿ã†é ˜åŸŸã‚µã‚¤ã‚ºï¼ˆå‚ç…§åŠå¾„ã¨ã„ã†ã‚‰ã—ã„ï¼‰ã‚’å°ã•ãã—ãªãŒã‚‰é€šå¸¸ã®ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ï¼ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ã‚’ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ç”¨ã«ä¿®æ­£ã™ã‚‹å¿…è¦ãŒãªã„ã€‚
* å‚ç…§åŠå¾„ã¯ç¹°ã‚Šè¿”ã—ï¼ˆã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰æ¯Žã«å¤‰ãˆã‚‹ãŒã€iç•ªç›®ã®ç¹°ã‚Šè¿”ã—ã§ã®åŠå¾„ã¯æ•°å¼ã§æ±‚ã‚ã‚‰ã‚Œã‚‹ãŸã‚ã€å‰å¾Œã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œã§ãã‚‹ã€‚ãã®ãŸã‚è¤‡æ•°ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†ã‚‚å®¹æ˜“ã€‚
* 1å›žã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯å°‘ãªã„ãƒ•ã‚©ãƒˆãƒ³æ•°ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ãƒ¡ãƒ¢ãƒªãŒå°‘ãªãã¦æ¸ˆã‚€ï¼ˆã“ã‚Œã¯Progressive PMå…¨èˆ¬ã®ç‰¹å¾´ï¼‰
* 100å›žã€1000å›žã¨å¤šæ•°ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ã§å‰¯æ¬¡çš„ãªåŠ¹æžœãŒç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ã€‚ä¾‹ãˆã°ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã€è¢«å†™ç•Œæ·±åº¦ã€ã‚°ãƒ­ã‚¹é¢ãªã©ã ã€‚

ä»¥å¾Œã€ã“ã®æ‰‹æ³•(Progressive Photon Mapping: Probabilistic Approach)ã‚’PPM-PAã¨æ›¸ãã“ã¨ã«ã™ã‚‹ã€‚

## 2. PPM-PAã®å®Ÿè£…

### -1. è¼åº¦å€¤å‡ºåŠ›ã¨çµ±åˆå‡¦ç†

ä¸Šè¨˜ã®é€šã‚Šã€ã“ã®PPM-PAã¯å¾“æ¥ã®ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ï¼ˆã»ã¼ï¼‰å¤‰æ›´ã—ãªãã¦æ¸ˆã‚€ã®ãŒã‚¦ãƒªã®ä¸€ã¤ã ã€‚å‚ç…§åŠå¾„ã‚’å¤‰åŒ–ã•ã›ã¦ç”Ÿæˆã—ãŸç”»åƒã‚’æœ€å¾Œã«å¹³å‡ã™ã‚Œã°è‰¯ã„ã€‚ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯è«–æ–‡ã«ã‚‚æ›¸ã„ã¦ã‚ã‚‹ãŒã€ç°¡å˜ãªæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨ä»¥ä¸‹ã®é€šã‚Šã€‚

```
r_1 â† åˆæœŸã®åŠå¾„
for i = 0 to N {  # Nã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›žæ•°
    å‚ç…§åŠå¾„r_iã§ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ã‚’å®Ÿè¡Œã—ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡
    i+1ç•ªç›®ã®å‚ç…§åŠå¾„(r_i+1)ã‚’æ±‚ã‚ã‚‹
}
å…¨ç”»åƒãƒ‡ãƒ¼ã‚¿ã®å„ç”»ç´ å€¤ã®å¹³å‡ã‚’è¨ˆç®—ã—ä¿ç®¡
```

ä»Šå›žã¯ã¡ã‚‡ã£ã¨ã‚µãƒœã£ã¦ã“ã®çµ±åˆå‡¦ç†ã¯Rubyã§è¨˜è¿°ã—ãŸï¼ˆutil/iterator.rb)ã€‚è©³ç´°ã¯ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦è²°ãˆã°ã‚ã‹ã‚‹ã¨æ€ã†ã€‚ã¨ã“ã‚ã§å¾“æ¥ã¯PPMå½¢å¼ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã€‚ã¤ã¾ã‚Šå„ç”»ç´ ã¯RGB 256éšŽèª¿ã®æ•´æ•°å€¤ã ã€‚ãã®ãŸã‚ä¸€å®šä»¥ä¸Šã®è¼åº¦å€¤ä»¥ä¸Šã¯255ã«ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã€‚PPM-PAã§ã¯è¼åº¦å€¤ã‚’é›†è¨ˆã—ã¦å¹³å‡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã§ãªã„ã¨ä½•ç™¾å›žã€ä½•åƒå›žç¹°ã‚Šè¿”ã™ã¨ã€ã»ã¨ã‚“ã©ã®ç”»ç´ ã¯é»’ã€æ‰€ã€…ã«è‰²ãŒå‡ºã‚‹ã¨ã„ã£ãŸç”»åƒã«ãªã‚‹ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¹³å‡ã™ã‚‹ã¨å€¤ãŒå°ã•ããªã‚Šã™ãŽã¦çœŸã£é»’ãªç”»åƒãŒå‡ºæ¥ä¸ŠãŒã‚‹ã®ã ã€‚æœ€åˆãã“ã«æ°—ã¥ã‹ãšå˜ç´”ã«PPMãƒ‡ãƒ¼ã‚¿ã‚’è¶³ã—ãŸãŸã‚ã€ã»ã¼çœŸã£é»’ã®ç”»åƒã¨ãªã£ã¦ã—ã¾ã£ãŸã€‚ã€‚ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã¯ï¼’ç‚¹ã®å°æ”¹é€ ã‚’å®Ÿæ–½ã—ãŸã€‚

* "progressive"ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã™ã‚‹ã€‚

    - å¾“æ¥é€šã‚ŠPPMã®ç”»åƒã‚’å‡ºåŠ›ã—ãŸã„å ´åˆã¨ã€PPM-PAã®ãŸã‚ã«ä¸€æ—¦ç”»åƒç”Ÿæˆçµæžœã®è¼åº¦å€¤ã‚’æ›¸ãå‡ºã™å ´åˆã‚’åˆ†ã‘ã‚‹ãŸã‚ã€"progressive"ãƒ•ãƒ©ã‚°ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã€‚å€¤ã¯"yes"ã‹"no"ã§ã‚ã‚‹ã€‚


* progressiveãƒ•ãƒ©ã‚°ã«å¿œã˜ã¦å‡ºåŠ›ã‚’PPMã‹è¼åº¦å€¤ã§å‡ºåŠ›ã™ã‚‹ã€‚

    - PPM-PAã‚’ä½¿ã†å ´åˆã¯è¼åº¦å€¤ã‚’ãã®ã¾ã¾è¨˜éŒ²ã™ã‚‹ãŸã‚ã€PPMãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆãªã‚‰0-255ã®æ•´æ•°å€¤ã‚’æ›¸ãå‡ºã™ã¨ã“ã‚ã€æµ®å‹•å°æ•°ç‚¹æ•°ã‚’æ–‡å­—åˆ—ã¨ã—ã¦æ›¸ãå‡ºã™ã€‚ä»¥ä¸‹ã¯ãã®éƒ¨åˆ†ã€‚ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°å‡¦ç†ã¯åˆ¥é€”è€ƒãˆã‚‹ãŸã‚ã€"smooth"é–¢æ•°ã¯å‘¼ã³å‡ºã•ãªã„ã€‚

```haskell:app/Main-rt.hs
if (progressive scr) == True                      
  then                                                 -- è¼åº¦å€¤ã‚’å‡ºåŠ›
    forM_ [0..(V.length image - 1)] $ \i -> do
      putStrLn $ radianceToString (image V.! i)
  else do
    let pixels = V.map (radianceToRgb scr) image
    forM_ [0..(V.length pixels - 1)] $ \i -> do
      rgb <- smooth tracer scr pixels i
      putStrLn $ rgbToString rgb          
```

ã“ã“ã§å‡ºåŠ›ã•ã‚Œã‚‹å½¢å¼ã®ç”»åƒãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã¯ç„¡ã„ãŒã€ã‚ã¨ã§é›†è¨ˆã§ãã‚‹ã‚ˆã†ã«ä¸€æ—¦æ›¸ãå‡ºã™ã ã‘ãªã®ã§æ‹˜ã‚‰ãªã„ã€‚ãªãŠã€çµæžœã‚’è¼åº¦å€¤ã§å‡ºåŠ›ã™ã‚‹ã“ã¨ã«ãªã‚‹ã¨ã€å¾“æ¥ã®ã€Œã‚¨ã‚»ã€ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ãŒã†ã¾ãåƒã‹ãªããªã‚‹ã€‚éš£ã‚Šåˆã†ç”»ç´ ã®RGBå€¤ã®å·®ã§ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°å‡¦ç†ã‚’è¡Œã†ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã¦ã„ãŸã‹ã‚‰ã ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯å¾Œã§è§¦ã‚Œã‚ˆã†ã€‚

### -2. è©•ä¾¡

#### â–  ãƒ•ã‚©ãƒˆãƒ³æ•°ã‚’ä¸€å®šã«ã—ãŸã¨ã

ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ã®ç”Ÿæˆç”»åƒã®å“è³ªã¯ãƒ•ã‚©ãƒˆãƒ³æ•°ã«ã‚ˆã‚‹ã€‚ãã“ã§ã€ç·ãƒ•ã‚©ãƒˆãƒ³æ•°ã‚’500ä¸‡å€‹ã«å›ºå®šã—ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒˆãƒ³æ•°ã‚’å¤‰ãˆã¦æ¯”è¼ƒã—ã¦ã¿ãŸã€‚

|photonæ•°|iterationæ•°|å‡¦ç†æ™‚é–“(s)|å‡¦ç†æ™‚é–“(s)/iteration|ãƒ¡ãƒ¢ãƒªé‡(MB)/iteration|ç”Ÿæˆç”»åƒ|
|---:|---:|---:|---:|---:|:---:|
|10,000 |500|3,632|7.27|65 |![ex-11.8-10000,500,0.1,p1,na.jpg](/images/raytracing-13/5milphoton/ex-11.8-10000,500,0.1,p1,na.jpg)|
|50,000 |100|1,034|10.34|120|![ex-11.8-50000,100,0.1,p1,na.jpg](/images/raytracing-13/5milphoton/ex-11.8-50000,100,0.1,p1,na.jpg)|
|100,000|50 |835  |16.70|169|![ex-11.8-100000,50,0.1,p1,na.jpg](/images/raytracing-13/5milphoton/ex-11.8-100000,50,0.1,p1,na.jpg)|
|200,000|25 |875  |34.99|359|![ex-11.8-200000,25,0.1,p1,na.jpg](/images/raytracing-13/5milphoton/ex-11.8-200000,25,0.1,p1,na.jpg)|
|500,000|10 |1,661|166.05|360|![ex-11.8-500000,10,0.1,p1,na.jpg](/images/raytracing-13/5milphoton/ex-11.8-500000,10,0.1,p1,na.jpg)|

ç·ãƒ•ã‚©ãƒˆãƒ³æ•°ãŒåŒã˜ã§ã‚‚å‡¦ç†æ™‚é–“ã¨å“è³ªã«ã¯çµæ§‹ã°ã‚‰ã¤ããŒå‡ºãŸã€‚ã“ã®ã‚·ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ã€ãƒ•ã‚©ãƒˆãƒ³æ•°100,000å€‹ãŒæœ€ã‚‚ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚ãƒ•ã‚©ãƒˆãƒ³æ•°ãŒ10,000å€‹ç¨‹åº¦ã¨å°‘ãªã„å ´åˆã§ã‚‚ã€ã‚ã‚‹ç¨‹åº¦ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒã‚ã‚‹ã‚ˆã†ã§ã€1å›žã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æŽ›ã‹ã‚‹æ™‚é–“ã¯åŠ‡çš„ã«çŸ­ã„ã‚ã‘ã§ã¯ãªã„ã‚ˆã†ã ã€‚

å“è³ªé¢ã§ã¯ã¡ã‚‡ã£ã¨å¾®å¦™ã ã£ãŸã€‚ç”»åƒã‚’è¦‹æ¯”ã¹ã¦ã‚‚ã‚ã¾ã‚Šã‚ã‹ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„ãŒã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›žæ•°ãŒå¤šã„ã¨å³ä¸‹ã®é›†å…‰æ¨¡æ§˜ã®ç¸ã®é‹­ã•ãŒã ã„ã¶é•ã†ã€‚10,000å€‹ãƒ»500ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ€ã‚‚è‰¯ã„ã€‚ãŸã ã€è‰²ã®æ»²ã¿ã¯ä¸€ç•ªã–ã‚‰ã–ã‚‰ã—ãŸæ„Ÿã˜ã§ã‚ã‚‹ã€‚ä¸€æ–¹ã€100,000å€‹ä»¥ä¸Šã ã¨ã€æ»²ã¿ã¯ã»ã¨ã‚“ã©é•ã„ãŒãªã„ã®ã§ã€ç¸ã®é‹­ã•ã¨å‡¦ç†æ™‚é–“ã‚’è€ƒãˆã‚‹ã¨200,000å€‹ä»¥ä¸Šã«ã™ã‚‹æ„å‘³ã¯ã»ã¼ãªã„ã¨æ€ã‚ã‚Œã‚‹ã€‚

#### â–  ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›žæ•°ã‚’ä¸€å®šã«ã—ãŸã¨ã

æ¬¡ã«ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›žæ•°ã‚’100ã«å›ºå®šã—ã¦æ¯”è¼ƒã—ãŸã€‚

|photonæ•°/iteration|å‡¦ç†æ™‚é–“(s)|å‡¦ç†æ™‚é–“(s)/iteration|å‡¦ç†æ™‚é–“(ms)/photon|ç”Ÿæˆç”»åƒ|
|---:|---:|---:|---:|:---:|
|1,000  |552  |5.52 |5.52|![ex-11.8-1000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-1000,100,0.1,p1,na.jpg)|
|5,000  |619  |6.19 |1.24|![ex-11.8-5000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-5000,100,0.1,p1,na.jpg)|
|10,000 |669  |6.69 |0.67|![ex-11.8-10000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-10000,100,0.1,p1,na.jpg)|
|50,000 |1,034|10.34|0.21|![ex-11.8-50000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-50000,100,0.1,p1,na.jpg)|
|100,000|1,508|15.08|0.15|![ex-11.8-100000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-100000,100,0.1,p1,na.jpg)|
|200,000|3,407|34.07|0.17|![ex-11.8-200000,100,0.1,p1,na.jpg](/images/raytracing-13/100iteration/ex-11.8-200000,100,0.1,p1,na.jpg)|

å½“ç„¶ã®çµæžœã ãŒã€åŒä¸€å›žæ•°ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã‚‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¯Žã®ãƒ•ã‚©ãƒˆãƒ³æ•°ãŒå¤šã„æ–¹ãŒå“è³ªãŒè‰¯ã„ã«æ±ºã¾ã£ã¦ã„ã‚‹ã€‚ãŸã ã€é—‡é›²ã«å¢—ã‚„ã™ã¨ãƒ¡ãƒ¢ãƒªã‚‚æ™‚é–“ã‚‚æŽ›ã‹ã‚Šã™ãŽã‚‹ã€‚ã“ã“ã§ã‚‚100,000å€‹ä»¥ä¸Šã«ãªã‚‹ã¨å“è³ªçš„ã«ã¯ã»ã¼å¤‰ã‚ã‚‰ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚æ”¾å°„è¼åº¦æŽ¨å®šã«ä½¿ã†ãƒ•ã‚©ãƒˆãƒ³ã¯kdæœ¨ã‹ã‚‰æ¤œç´¢ã™ã‚‹ã€‚ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ã¯è¨ˆç®—é‡ãŒ O(n log n)ã«ãªã‚‹ã‚‰ã—ã„ã®ã§nãŒ10,000ä»¥ä¸Šã«ãªã£ã¦ãã‚‹ã¨å‡¦ç†æ™‚é–“ã¯ã»ã¼nã«æ¯”ä¾‹ã™ã‚‹ã‚ˆã†ã«æ€ãˆã‚‹ã®ã ãŒã€å®Ÿéš›ã«ã¯æŒ‡æ•°é–¢æ•°çš„ã«å‡¦ç†æ™‚é–“ãŒæŽ›ã‹ã‚‹ã‚ˆã†ã ã€‚ãƒ•ã‚©ãƒˆãƒ³æ•°100,000å€‹ã¾ã§ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã®ãŸã‚ã‹ã‚ã¾ã‚Šæ™‚é–“å·®ã¯ç„¡ã„ãŒã€ãã‚Œã‚’è¶…ãˆã‚‹ã¨å‡¦ç†æ™‚é–“ãŒæ€¥å¢—ã™ã‚‹ã€‚ã¡ãªã¿ã«ï¼‘å›žã‚ãŸã‚Šãƒ•ã‚©ãƒˆãƒ³æ•°500ä¸‡å€‹ã§è¨ˆç®—ã—ã‚ˆã†ã¨ã—ãŸã‚‰6æ™‚é–“çµŒã£ã¦ã‚‚1ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãªã„ã®ã§ä¸­æ–­ã—ãŸã€‚ä»Šå›žã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã¯å‚ç…§åŠå¾„ãŒæ±ºã¾ã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ•ã‚©ãƒˆãƒ³ãŒå¤šã„ã»ã©ãã®é ˜åŸŸã«å«ã¾ã‚Œã‚‹ãƒ•ã‚©ãƒˆãƒ³ãŒå¤šããªã‚‹ã‚ã‘ã§ã€ä¸€å€‹ã®ãƒ•ã‚©ãƒˆãƒ³ã‚’æ¤œç´¢ã™ã‚‹è¨ˆç®—é‡xãƒ•ã‚©ãƒˆãƒ³æ•°å¢—åŠ é‡ã®æ™‚é–“ãŒæŽ›ã‹ã‚‹ã“ã¨ãŒä¸€å› ã§ã¯ã¨æ€ã†ã€‚

#### â–  ä¸¦åˆ—å‡¦ç†

ä»Šå›žã¯çµ±åˆå‡¦ç†ã‚’Rubyã§æ›¸ã„ãŸãŒã€ä¸¦åˆ—å‡¦ç†ï¼ˆãƒžãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ï¼‰ã‚‚Rubyã§è¡Œã£ãŸã€‚çµè«–ã‹ã‚‰ã„ã†ã¨ã‚ã¾ã‚ŠåŠ¹æžœãŒå‡ºãªã‹ã£ãŸã€‚Rubyã§ã¯ãƒžãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã«ã—ã¦ã‚‚CPUå‡¦ç†ã¯ç›´åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚‰ã—ã„ã€‚

[Rubyã§CPUã‚³ã‚¢ã‚’ãƒ•ãƒ«æ´»ç”¨ã—ã¦ã¿ãŸ](https://qiita.com/tsukasa_oishi/items/beda7e7ddcf92c8e634d)

ãƒ•ã‚©ãƒˆãƒ³æ•°100,000å€‹ã€500ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒžãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã‚’å¤‰ãˆã¦æ™‚é–“ã‚’è¨ˆæ¸¬ã—ãŸã€‚

|ä¸¦åˆ—åº¦|1|2|4|10|
|---|---:|---:|---:|---:|
|å‡¦ç†æ™‚é–“(s)|835|757|637|664|

ä½¿ç”¨ã—ãŸPCã¯4ã‚³ã‚¢ãªã®ã§ã€I/OãŒã‚ã‚‹ç¨‹åº¦ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚ŒãŸã®ã‹ä¸¦åˆ—åº¦4ã¾ã§ã¯è‹¥å¹²æ™‚é–“çŸ­ç¸®ãŒã¯ã‹ã‚Œã¦ã„ã‚‹ãŒã€ãã‚Œä»¥ä¸Šã ã¨é€†ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå¤§ãããªã‚‹ã‚ˆã†ã ã€‚
### -3. OpenEXRå¯¾å¿œ

å…ˆæ—¥å›³æ›¸é¤¨ã§"[digital] ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°&ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ç¬¬ï¼“ç‰ˆ"ã¨ã„ã†æœ¬ã‚’è¦‹ã¤ã‘ãŸã®ã§èª­ã‚“ã§ã„ãŸã‚‰ã„ã‚ã„ã‚çŸ¥ã‚‰ãªã„ã“ã¨ãŒæ›¸ã„ã¦ã‚ã£ãŸã®ã ãŒã€ãã“ã« High Dynamic Range Image (HDRI) ã®èª¬æ˜ŽãŒã‚ã£ãŸã€‚å¾“æ¥ã¯RGBè¨ˆ24bitã§ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡ã—ã¦ããŸãŒã€ç”»åƒç”Ÿæˆæ™‚ã¯è¼åº¦ã‚’è¨ˆç®—ã—ã¦ã„ã‚‹ã€‚ä¸Šè¨˜ã®é€šã‚ŠPPM-PAã®ãŸã‚ã«ã‚ã–ã‚ã–è¼åº¦å€¤ï¼ˆæµ®å‹•å°æ•°ç‚¹æ•°ï¼‰ã§å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«å¤‰ãˆãŸã®ã ã‹ã‚‰ã€ã›ã£ã‹ããªã‚‰ãã®ã¾ã¾ä¿ç®¡ã§ããŸæ–¹ãŒæ´»ç”¨ã®å¹…ãŒåºƒãŒã‚‹ã€‚ãã“ã§ã€æœ€çµ‚çµæžœã¯PPMã ã‘ã§ãªãOpenEXRå½¢å¼ã§ã‚‚ä¿ç®¡ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã€‚util/averager2.rbãŒãã‚Œã§ã‚ã‚‹ã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®è©³ç´°ã¯ä»¥ä¸‹ã®URLã«è©³ã—ãæ›¸ã„ã¦ã‚ã‚‹ã€‚

  [OpenEXR File Layout](https://www.openexr.com/documentation/openexrfilelayout.pdf)

ç‰¹ã«æœ€å¾Œã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒèª¬æ˜Žã•ã‚Œã¦ã„ã‚‹ã®ã ãŒã€ãƒã‚¤ãƒˆåˆ—ã¨ãã®æ„å‘³ãŒå…¨éƒ¨è¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šå¤§ã„ã«å‚è€ƒã«ãªã£ãŸã€‚ã²ã¨ã¾ãšã“ã®å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ãŒä½œã‚Œã‚Œã°è‰¯ã„ã®ã§ã€Single-Partã€éžåœ§ç¸®ã€ãƒãƒ£ãƒãƒ«ã¯RGBï¼“è‰²ã®ã¿ã€å„è‰²ã¯å˜ç²¾åº¦æµ®å‹•å°æ•°ç‚¹æ•°(32bit)ã¨ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹ã®ã§ã¯ï¼Ÿã¨ã‚‚æ€ã£ãŸãŒã€PPMã§ã‚‚å„è‰²ãŒï¼“æ¡ã®æ•°å­—ã ã¨1ãƒ”ã‚¯ã‚»ãƒ«ã‚ãŸã‚Š12ãƒã‚¤ãƒˆã€OpenEXRã§ã‚‚å…ˆã®æ¡ä»¶ãªã‚‰12ãƒã‚¤ãƒˆãªã®ã§ãã‚Œç¨‹ã®å·®ã¯ãªã„ã€‚å®Ÿéš›ã€256x256è§£åƒåº¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨ç´„791KBã§ã‚ã‚‹ã€‚ã¡ãªã¿ã«ImageMagickã§JPEGã«å¤‰æ›ã—ã¦ã¿ã‚‹ã¨ç´„17KBã«ãªã£ãŸãƒ»ãƒ»ãƒ»ã€‚

ãªãŠOpenEXRã§ä¿å­˜ã—ã¦ãŠãã¨ã€ã‚ã¨ã§éœ²å‡ºãªã©ã‚’ç°¡å˜ã«å¤‰ãˆã‚‰ã‚Œã¦ãªã‹ãªã‹æ¥½ã—ã„ã“ã¨ã‚‚ã‚ã‹ã£ãŸã€‚

## 3. PPM-PAã®å¿œç”¨

PPM-PAã®ç›´æŽ¥çš„ãªãƒ¡ãƒªãƒƒãƒˆã¯ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æŠ‘ãˆã€ã‹ã¤ãƒ•ã‚©ãƒˆãƒ³ãƒžãƒƒãƒ”ãƒ³ã‚°æ³•ã«ç‰¹æœ‰ã®è‰²ã®æ»²ã¿ã¨ã¼ã‚„ã‘ã‚’åŒæ™‚ã«ç·©å’Œã§ãã‚‹ã“ã¨ã§ã‚ã‚‹ã¨æ€ã†ã€‚ã—ã‹ã—ã€ç‹¬ç«‹ã—ãŸã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ•°ç™¾ã€æ•°åƒå›žç¹°ã‚Šè¿”ã™ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãªã®ã§ã€å‰¯æ¬¡çš„ã«æ¬¡ã®åŠ¹æžœã‚‚å®¹æ˜“ã«å®Ÿè£…ã§ãã‚‹ã®ãŒå¼·ã¿ã§ã‚ã‚‹ã€‚

* ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°
* è¢«å†™ç•Œæ·±åº¦ã«ã‚ˆã‚‹ãƒœã‚±
* å…‰æ²¢é¢
* ã‚¨ãƒªã‚¢å…‰æºã®åŠå½±ï¼ˆç›´æŽ¥å…‰ã«å¤å…¸ãƒ¬ã‚¤ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æ³•ã‚’ç”¨ã„ãŸå ´åˆï¼‰

ä»Šå›žã¯ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’ï¼ˆç°¡å˜ã ãŒï¼‰å®Ÿè£…ã—ãŸã®ã§æ›¸ã„ã¦ãŠãã€‚

#### â–  anti-aliasing

æœ€åˆã«æ›¸ã„ãŸã‚ˆã†ã«ã€PPM-PAæ³•ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«å¾“æ¥ã®ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°å‡¦ç†ã¯è«¦ã‚ã–ã‚‹ã‚’ãˆãªããªã£ãŸãŒã€å¤šæ•°ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ã§ã‚ˆã‚Šè‰¯ã„ï¼ˆæœ¬å½“ã®ï¼Ÿï¼‰ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã£ãŸã€‚å¾“æ¥ã¨ä»Šå›žã®å®Ÿè£…ã®é•ã„ã¯ä¸‹å›³ã®ã¨ãŠã‚Šã€‚

![AAdiff.png](/images/raytracing-13/AAdiff.png)


å¾“æ¥ï¼ˆå·¦ï¼‰ã¯ä¸€åº¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸå¾Œã®ã€Œè¿½åŠ å‡¦ç†ã€ã ã£ãŸã®ã§è¿½åŠ ã™ã‚‹ãƒ¬ã‚¤(èµ¤ä¸¸)ã‚’ï¼”ã¤ã ã‘ã«ã—ã€ãƒ¬ã‚¤ã®æ–¹å‘ã‚‚åã‚‰ãªã„ã‚ˆã†ã‚ãˆã¦å›ºå®šã—ãŸã€‚PPM-PAï¼ˆå³ï¼‰ã§ã¯100å›žã€1000å›žã¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã®ã§ã€ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ¬ã‚¤ã‚’é£›ã°ã—ã¦ã‚‚åã‚Šã¯å°‘ãªã„ã ã‚ã†ã€‚

ã¾ãŸã€PPM-PAã§ã®ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã¯ã€Œè¿½åŠ å‡¦ç†ã€ã§ã¯ãªã„ã®ã§è¨ˆç®—ã‚³ã‚¹ãƒˆãŒå¢—ãˆãªã„ã®ã‚‚å¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã‚ã‚‹ã€‚ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¯Žã«ãƒ¬ã‚¤ã®æ–¹å‘ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ãšã‚‰ã—ã¦ã‚ã’ã‚Œã°è‰¯ã„ã®ã ã€‚ã¨ã„ã†ã“ã¨ã§ã€å®Ÿè£…ã‚‚éžå¸¸ã«ç°¡å˜ã§ã‚ã‚‹ã€‚ã“ã“ã§ `r3`,`r4`ã¯ç”»ç´ ã®ä¸­å¿ƒã‹ã‚‰ã®x,yåº§æ¨™ã®ãšã‚Œå…·åˆï¼ˆ-0.5 ã€œ 0.5ï¼‰ã§ã‚ã‚‹ã€‚

```haskell:src/Screen.hs
  (r3, r4) <- if prflag == True && aaflag == True
    then do
      r3' <- MT.randomIO :: IO Double
      r4' <- MT.randomIO :: IO Double
      return (r3' - 0.5, r4' - 0.5)
    else
      return (0.0, 0.0)
```

ifæ–‡ã§"prflag == True"ã¯PPM-PAã‚’ä½¿ã†ã“ã¨ã€"aaflag == True"ã¯ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã‚’
æ„å‘³ã—ã¦ã„ã‚‹ã€‚ã©ã¡ã‚‰ã‹ã®ãƒ•ãƒ©ã‚°ãŒFalseã®å ´åˆã¯ãšã‚‰ã•ãªã„ã®ã§0.0ã‚’è¿”ã™ã€‚ã‚„ã‚‹ã“ã¨ã¯ãŸã£ãŸã“ã‚Œã ã‘ã§ã‚ã‚‹ã€‚

åŠ¹æžœã®ã»ã©ã¯ä¸‹ã®ç”»åƒã§æ¯”ã¹ã¦ã¿ã‚Œã°ã‚ˆãã‚ã‹ã‚‹ã€‚å·¦ãŒã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ãªã—ã€å³ãŒã‚ã‚Šã ã€‚å³ã®æ–¹ã¯çƒã®ä¸Šéƒ¨ã‚„å¤©äº•ã‹ã‚‰ã®å…‰ã®æ–œã‚ã«ãªã£ã¦ã„ã‚‹å¢ƒç•Œã®ã‚®ã‚¶ã‚®ã‚¶ï¼ˆã‚¸ãƒ£ã‚®ãƒ¼ï¼‰ãŒç·©å’Œã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã€‚è¨ˆç®—ã‚³ã‚¹ãƒˆãŒå¢—ãˆãªã„ã®ã§ã€ã‚‚ã†ã“ã‚Œã‹ã‚‰ã¯ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚ã‚Šã ã‘ã§è‰¯ã„ã ã‚ã†ã€‚(ç”»åƒã¯è§£åƒåº¦256x256ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³500å›žã€1å›žã‚ãŸã‚Š100000ãƒ•ã‚©ãƒˆãƒ³)

|ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ãªã—|ã‚¢ãƒ³ãƒã‚¨ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚ã‚Š|
|---|---|
|![ex-sunwindow-100000,500,0.1,p4,na.jpg](/images/raytracing-13/antialias/ex-sunwindow-100000,500,0.1,p4,na.jpg)|![ex-sunwindow-100000,500,0.1,p4,aa.jpg](/images/raytracing-13/antialias/ex-sunwindow-100000,500,0.1,p4,aa.jpg)|




## 4. ã¾ã¨ã‚

2å¹´ä»¥ä¸Šã¶ã‚Šã®è¨˜äº‹ã¨ãªã£ãŸã€‚ãã®é–“ç´°ã‹ã„å¤‰æ›´ã‚’ã„ãã¤ã‹ã‚„ã£ã¦ã„ã¦ã€è¨˜äº‹ã«ã¾ã¨ã‚ã¦ãŠã‹ãªã„ã¨å‚™å¿˜éŒ²ã«ãªã‚‰ãªã„ã®ã§æ›¸ã„ã¦ã¿ãŸãŒã€ä»Šå›žã®è¨˜äº‹ã¯ã»ã¨ã‚“ã©å®Ÿè£…é¢ã§ã®èª¬æ˜ŽãŒãªãé¢ç™½å‘³ãŒãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ãŸã ã€3ã§æŒ™ã’ãŸã„ãã¤ã‹ã®é‡è¦ãªã€Œãƒœã‚±ã€ãªã©ã®åŠ¹æžœãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã®ãŸã‚ã®å¸ƒçŸ³ã¨ã—ã¦ã¯å–ã‚Šçµ„ã‚“ã§ã‚ˆã‹ã£ãŸã¨æ€ã†ã€‚æ¬¡ã¯ã“ã‚Œã‚‰ã®åŠ¹æžœã‚’è¿½åŠ ã—ã¦ã„ã“ã†ã€‚


