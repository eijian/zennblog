---
title: ""
emoji: "ðŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---




0. Lightåž‹ã®å†æ§‹ç¯‰

data LightSpec = LightSpec
  { lcolor      :: !Color         -- RGBã®æ¯”çŽ‡ã€r+g+b = 1.0
  , radiosity   :: !Radiosity     -- æ”¾å°„ç™ºæ•£åº¦ [W/m^2]
  , directivity :: !Double        -- æŒ‡å‘æ€§ (0.0:æŒ‡å‘æ€§ãªã— - 1.0:å¹³è¡Œå…‰æº)
  , radest      :: !RadEstimation -- ç›´æŽ¥å…‰ã®è¼åº¦å€¤è¨ˆç®—æ–¹æ³•
  , dirflag     :: !InOut         -- ç™ºå…‰æ–¹å‘ï¼ˆé€šå¸¸å…‰æº=Out, ãƒ‰ãƒ¼ãƒ å…‰æºç­‰=In)
  -- calcuration when initializing
  , cospower    :: !Double
  , power       :: !Double
  , emittance0  :: !Radiance      -- æ”¾å°„è¼åº¦ï¼ˆé¢æ³•ç·šæ–¹å‘ï¼‰
  }
  deriving (Eq, Show, Generic)


  
1. è‰²æ¸©åº¦ã¨ãƒ«ãƒ¼ãƒ¡ãƒ³

ãƒ» æ¸¬å…‰å­¦ã€æ”¾å°„åˆ†æžå­¦

  æ”¾å°„é‡              æ¸¬å…‰é‡(äººé–“ã®çœ¼ãŒæ„Ÿã˜ã‚‹)
  æ”¾å°„æŸ(J/s=W)       å…‰æŸ(lm)
  æ”¾å°„ç™ºæ•£åº¦(W/m2)    å…‰æŸç™ºæ•£åº¦(lm/m2=lx)
    Radiosity
  æ”¾å°„å¼·åº¦            å…‰åº¦
  æ”¾å°„è¼åº¦            è¼åº¦

  æ”¾å°„é‡ï¼ˆãƒ¯ãƒƒãƒˆå˜ä½ï¼‰ã‹ã‚‰æ¸¬å…‰é‡ï¼ˆãƒ«ãƒ¼ãƒ¡ãƒ³å˜ä½ï¼‰ã¸ã®å¤‰æ›ã«ã¯ã€
  æœ€å¤§è¦–æ„ŸåŠ¹æžœåº¦ Km ã¨å‘¼ã°ã‚Œã‚‹å¤‰æ›å®šæ•°ã‚’æŽ›ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    Km ï¼ 683 [ lm / W ] â† æ³¢é•·555nmãŒãƒ”ãƒ¼ã‚¯ãªã®ã§ãã“ã®å€¤ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚‹
  ãƒ«ãƒ¼ãƒ¡ãƒ³(lumen)ã¯æ”¾å°„åˆ†æžå­¦ã§ã®æ”¾å°„æŸã«ç›¸å½“ã—ã€1ç§’é–“ã§äººé–“ã®çœ¼ã®æ„Ÿåº¦ç‰¹æ€§ã§è¦‹ãŸæ™‚ã«æ„Ÿã˜ã‚‹æ˜Žã‚‹ã•ã€Œå…‰æŸã€ã®å˜ä½

  â˜…WãŒJ/sã¨ã„ã†ã“ã¨ã¯1ç§’å½“ãŸã‚Šã®ã‚¨ãƒãƒ«ã‚®ãƒ¼é‡ã¨ã„ã†ã“ã¨ã€‚ã‚«ãƒ¡ãƒ©ã§ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒ1/100ã ã¨ã€
    å…‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯æŒ‡å®šå€¤ã®1/100ã¨ã„ã†ã“ã¨ã«ãªã‚‹

initLightSpec :: Color -> Radiosity -> Double -> RadEstimation -> InOut
  -> LightSpec
initLightSpec col lux direct radest dirf =
  LightSpec col radiosity direct radest dirf cpow pow em
  where
    radiosity = lux / 683.0   -- flux [W] = lumen / 683.0, lux = lumen / S [lumen/m^2]
    (cpow, pow)  = densityPower (direct ** 3)
    em0 = sr_half * radiosity
    em  = em0 *> col <**> radiance1

initColorByKelvin :: Double -> Color
initColorByKelvin t = normalizeColor (Color (clip r) (clip g) (clip b))
  where
    t' = t / 100.0
    r = if t' <= 66.0
      then 255.0
      else
        329.698727446 * ((t' - 60) ** (-0.1332047592))
    g = if t' <= 66.0
      then 99.4708025861 * (logBase (exp 1) t') - 161.1195681661
      else 288.1221695283 * (t' - 60) ** (-0.0755148492)
    b = if t' >= 66.0
      then 255.0
      else 138.5177312231 * (logBase (exp 1) (t' - 10)) - 305.0447927307
    clip :: Double -> Double
    clip c = if c > 255.0
      then 1.0
      else c / 255.0


